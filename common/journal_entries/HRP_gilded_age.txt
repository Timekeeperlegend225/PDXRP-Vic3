je_HRP_gilded_age = {
	icon = "gfx/interface/icons/invention_icons/mutual_funds.dds"

	group = je_group_historical_content

	immediate = {
		set_variable = current_growth_setup
		set_variable = GA_rp_national 
		set_variable = {
			name = GM_action_cost
			value = gdp
		}
		change_variable = {
			name = GA_previous_global_gpd
			divide = -10
		}
		set_variable = {
			name = Gilded_actions
			value = 0
		}
	}

	scripted_progress_bar = HRP_GA_infinite_growth
	scripted_progress_bar = HRP_GA_national_speculation

	invalid = {
		custom_tooltip = {
			text = "Never, why would growth ever be stop ?"
			NOT = {
				has_global_variable = gilded_age_gm
			}
		}
	}
	status_desc = {
	}
	
	scripted_button = GA_buy_action
	scripted_button = GA_sell_action
	scripted_button = GA_encourage_speculation
	scripted_button = GA_stop_encouraging_speculation

	on_monthly_pulse = {
		effect = {
			set_variable = {
				name = GM_action_cost
				value = gdp
			}
			change_variable = {
				name = GM_action_cost
				divide = 10
			}
			set_variable = {
				name = temp_growth
				value = "scope:journal_entry.scripted_bar_progress(HRP_GA_infinite_growth)" 
			}
			change_variable = {
				name = temp_growth
				divide = 1000000
			}
			change_variable = {
				name = temp_growth
				add = 1
			}
			change_variable = {
				name = GM_action_cost
				multiply = var:temp_growth
			}
			set_variable = {
				name = GM_action_cost_neg
				value = var:GM_action_cost
			}
			change_variable = {
				name = GM_action_cost_neg
				multiply = -1
			}
			set_variable = {
				name = temp_money_available
				value = credit
			}
			change_variable = {
				name = temp_money_available
				subtract = principal
			}
			if = {
				limit = {
					has_variable = current_growth_setup
				}
				scope:journal_entry = { 
					add_progress = { 
						name = HRP_GA_infinite_growth 
						value = global_var:GA_current_growth
					}
				}
				remove_variable = current_growth_setup
			}
			HRP_GA_infinite_growth_progress = yes 
			HRP_GA_national_speculation_progress = yes 
			scope:journal_entry = { 
				remove_modifier = HRP_speculation
				add_modifier = {
					name = HRP_speculation
					multiplier = {
						add = "scope:journal_entry.scripted_bar_progress(HRP_GA_infinite_growth)" 
						multiply  = "scope:journal_entry.scripted_bar_progress(HRP_GA_national_speculation)" 
						divide  = 100000000
					}
				}
			}
		}
	}
	
	should_be_pinned_by_default = yes
}

je_HRP_gilded_age_gm = {
	icon = "gfx/interface/icons/invention_icons/mutual_funds.dds"

	group = je_group_historical_content

	modifiers_while_active = {
	}

	immediate = {
		set_global_variable = { 
			name = GA_previous_global_gpd
			value = 0
		}
		every_country = {
			change_global_variable = {
				name = GA_previous_global_gpd
				add = gdp
			}
		}
		set_global_variable = { 
			name = GA_GM_adjustment_flat
			value = 0
		}
		set_global_variable = { 
			name = GA_GM_adjustment_multiplier
			value = 0
		}
		set_variable = {
			name = GM_action_cost
			value = gdp
		}
		change_variable = {
			name = GM_action_cost
			divide = -10
		}
		set_variable = {
			name = Gilded_actions
			value = 0
		}
	}

	scripted_progress_bar = HRP_GA_infinite_growth
	scripted_progress_bar = HRP_GA_national_speculation
	
	scripted_button = GA_buy_action
	scripted_button = GA_sell_action
	scripted_button = GA_encourage_speculation
	scripted_button = GA_stop_encouraging_speculation

	status_desc = {
	}

	invalid = {
		custom_tooltip = {
			text = "Never, why would growth ever stop ?"
			NOT = {
				has_global_variable = gilded_age_gm
			}
		}
	}

	on_monthly_pulse = {
		effect = { 
			set_variable = {
				name = GM_action_cost
				value = gdp
			}
			change_variable = {
				name = GM_action_cost
				divide = -10
			}
			set_variable = {
				name = temp_growth
				value = "scope:journal_entry.scripted_bar_progress(HRP_GA_infinite_growth)" 
			}
			set_global_variable = { 
				name = GA_current_growth
				value = var:temp_growth
			}
			change_variable = {
				name = temp_growth
				divide = 1000000
			}
			change_variable = {
				name = temp_growth
				add = 1
			}
			change_variable = {
				name = GM_action_cost
				multiply = var:temp_growth
			}
			set_variable = {
				name = temp_money_available
				value = principal
			}
			change_variable = {
				name = temp_money_available
				subtract = credit
			}
			set_global_variable = { 
				name = GA_previous_global_gpd
				value = global_var:GA_current_global_gpd
			} 
			set_global_variable = { 
				name = GA_current_global_gpd
				value = 0
			}
			set_global_variable = { 
				name = GA_companies_prosperity
				value = 0
			} 
			every_country = {
				change_global_variable = {
					name = GA_current_global_gpd
					add = gdp
				}
				every_company = {
					change_global_variable = {
						name = GA_companies_prosperity
						add = this.company_prosperity
					} 
				}
			}
			set_global_variable = { 
				name = GA_global_gpd_difference
				value = global_var:GA_current_global_gpd
			} 
			change_global_variable = {
				name = GA_global_gpd_difference
				subtract = global_var:GA_previous_global_gpd
			} 
			set_global_variable = { 
				name = GA_global_trade
				value = 0
			} 
			GA_global_trade_calculation
			set_global_variable = { 
				name = GA_tech_joint
				value = 0
			}
			set_global_variable = { 
				name = GA_tech_mutual
				value = 0
			}
			set_global_variable = { 
				name = GA_tech_invest
				value = 0
			}
			set_global_variable = { 
				name = GA_tech_inter
				value = 0
			}
			every_country = {
				if = {
					limit = {
						country_rank = rank_value:great_power
					}
					if = {
						limit = {
							has_technology_researched = joint_stock_companies
						}
						change_global_variable = {
							name = GA_tech_joint
							add = 1
						}
					}
					if = {
						limit = {
							has_technology_researched = mutual_funds
						}
						change_global_variable = {
							name = GA_tech_mutual
							add = 2
						}
					}
					if = {
						limit = {
							has_technology_researched = investment_banks
						}
						change_global_variable = {
							name = GA_tech_invest
							add = 5
						}
					}
					if = {
						limit = {
							has_technology_researched = international_exchange_standards
						}
						change_global_variable = {
							name = GA_tech_inter
							add = 10
						}
					}
				}
				else_if = {
					limit = {
						country_rank = rank_value:major_power
					}
					if = {
						limit = {
							has_technology_researched = joint_stock_companies
						}
						change_global_variable = {
							name = GA_tech_joint
							add = 0.5
						}
					}
					if = {
						limit = {
							has_technology_researched = mutual_funds
						}
						change_global_variable = {
							name = GA_tech_mutual
							add = 1
						}
					}
					if = {
						limit = {
							has_technology_researched = investment_banks
						}
						change_global_variable = {
							name = GA_tech_invest
							add = 2.5
						}
					}
					if = {
						limit = {
							has_technology_researched = international_exchange_standards
						}
						change_global_variable = {
							name = GA_tech_inter
							add = 5
						}
					}
				}
				else_if = {
					limit = {
						OR = {
							country_rank = rank_value:minor_power
							country_rank = rank_value:unrecognized_major_power
						}
					}
					if = {
						limit = {
							has_technology_researched = joint_stock_companies
						}
						change_global_variable = {
							name = GA_tech_joint
							add = 0.2
						}
					}
					if = {
						limit = {
							has_technology_researched = mutual_funds
						}
						change_global_variable = {
							name = GA_tech_mutual
							add = 0.5
						}
					}
					if = {
						limit = {
							has_technology_researched = investment_banks
						}
						change_global_variable = {
							name = GA_tech_invest
							add = 1
						}
					}
					if = {
						limit = {
							has_technology_researched = international_exchange_standards
						}
						change_global_variable = {
							name = GA_tech_inter
							add = 2
						}
					}
				}
				else = {
					if = {
						limit = {
							has_technology_researched = joint_stock_companies
						}
						change_global_variable = {
							name = GA_tech_joint
							add = 0.1
						}
					}
					if = {
						limit = {
							has_technology_researched = mutual_funds
						}
						change_global_variable = {
							name = GA_tech_mutual
							add = 0.2
						}
					}
					if = {
						limit = {
							has_technology_researched = investment_banks
						}
						change_global_variable = {
							name = GA_tech_invest
							add = 0.5
						}
					}
					if = {
						limit = {
							has_technology_researched = international_exchange_standards
						}
						change_global_variable = {
							name = GA_tech_inter
							add = 1
						}
					}
				}
			}
			HRP_GA_infinite_growth_progress = yes 
			HRP_GA_national_speculation_progress = yes 
			scope:journal_entry = { 
				remove_modifier = HRP_speculation
				add_modifier = {
					name = HRP_speculation
					multiplier = {
						add = "scope:journal_entry.scripted_bar_progress(HRP_GA_infinite_growth)" 
						multiply  = "scope:journal_entry.scripted_bar_progress(HRP_GA_national_speculation)" 
						divide  = 100000000
					}
				}
			}
		}
	}
	
	should_be_pinned_by_default = yes
}